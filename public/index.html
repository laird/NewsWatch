<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NewsWatch - Daily Software Economy Brief</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Chomsky&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Playfair+Display:wght@400;700;900&family=UnifrakturMaguntia&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="newspaper">
        <header class="masthead">
            <div class="ears">
                <div class="ear-left">
                    VOL. CLXXII... No. 42<br>
                    NEW YORK, SATURDAY
                </div>
                <div class="title-wrapper">
                    <h1 class="paper-title">NewsWatch</h1>
                    <div class="paper-subtitle">Daily Software Economy Brief</div>
                </div>
                <div class="ear-right">
                    PRICE FIVE CENTS<br>
                    <span id="current-date"></span>
                </div>
            </div>
        </header>

        <main class="content">
            <div id="stories-container" class="story-grid">
                <div
                    style="padding: 40px; text-align: center; color: #111; font-family: 'Times New Roman', serif; grid-column: 1/-1;">
                    Loading the latest edition...</div>
            </div>
        </main>

        <footer class="footer">
            <div class="separator-line-single"></div>
            <p>&copy; 2024 NewsWatch. All rights reserved.</p>
        </footer>
    </div>

    <script src="script.js"></script>
    <script>
        // Set date
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });

        // Fetch stories
        fetch('/api/stories')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('stories-container');
                const stories = data.stories || [];

                if (stories.length === 0) {
                    container.innerHTML = '<div style="padding: 40px; text-align: center; color: #111; font-family: \'Times New Roman\', serif; grid-column: 1/-1;">No stories found. Run ingestion to populate.</div>';
                    return;
                        <h2 class="headline">
                            <a href="story.html?id=${storyId}">${story.headline}</a>
                        </h2>
                        <div class="meta">
                            <span class="source-badge">${story.source}</span>
                            <span class="separator">â€¢</span>
                            <span>${new Date(story.published_at).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</span>
                        </div>

                        <div class="summary">
                            ${teaser}
                            <a href="story.html?id=${storyId}" class="read-more">[Read Full Story]</a>
                        </div>
                    </article >
                        `;
                            }).join('');
                        })
                        .catch(err => {
                            console.error('Error fetching stories:', err);
                            document.getElementById('stories-container').innerHTML = '<div style="padding: 40px; text-align: center; color: #ef4444; font-family: \'Times New Roman\', serif; grid-column: 1/-1;">Error loading stories. Is the server running?</div>';
                        });

                    /**
                     * Convert markdown to HTML
                     */
                    function convertMarkdownToHTML(text) {
                        if (!text) return text;
                        return text
                            .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                            .replace(/__(.+?)__/g, '<strong>$1</strong>')
                            .replace(/\*(.+?)\*/g, '<em>$1</em>')
                            .replace(/_(.+?)_/g, '<em>$1</em>')
                            .replace(/`(.+?)`/g, '<code style="background-color: #f4f4f4; padding: 2px 4px; border-radius: 3px; font-family: monospace;">$1</code>')
                            .replace(/\n/g, '<br>');
                    }

                    /**
                     * Get impact icon based on score
                     */
                    function getImpactIcon(score) {
                        if (score <= 2) { // Strong Negative
                            return {
                                bgColor: '#fee2e2', color: '#b91c1c',
                                svg: `< svg viewBox = "0 0 24 24" fill = "none" stroke = "currentColor" stroke - width="2.5" stroke - linecap="round" stroke - linejoin="round" style = "width: 16px; height: 16px;" ><line x1="12" y1="5" x2="12" y2="19"></line><polyline points="19 12 12 19 5 12"></polyline></svg > `
                            };
                        } else if (score <= 4) { // Weak Negative
                            return {
                                bgColor: '#fef2f2', color: '#dc2626',
                                svg: `< svg viewBox = "0 0 24 24" fill = "none" stroke = "currentColor" stroke - width="2.5" stroke - linecap="round" stroke - linejoin="round" style = "width: 16px; height: 16px;" ><line x1="7" y1="7" x2="17" y2="17"></line><polyline points="17 7 17 17 7 17"></polyline></svg > `
                            };
                        } else if (score <= 6) { // Neutral
                            return {
                                bgColor: '#f3f4f6', color: '#6b7280',
                                svg: `< svg viewBox = "0 0 24 24" fill = "none" stroke = "currentColor" stroke - width="2.5" stroke - linecap="round" stroke - linejoin="round" style = "width: 16px; height: 16px;" ><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg > `
                            };
                        } else if (score <= 8) { // Weak Positive
                            return {
                                bgColor: '#f0fdf4', color: '#16a34a',
                                svg: `< svg viewBox = "0 0 24 24" fill = "none" stroke = "currentColor" stroke - width="2.5" stroke - linecap="round" stroke - linejoin="round" style = "width: 16px; height: 16px;" ><line x1="7" y1="17" x2="17" y2="7"></line><polyline points="7 7 17 7 17 17"></polyline></svg > `
                            };
                        } else { // Strong Positive
                            return {
                                bgColor: '#ecfdf5', color: '#059669',
                                svg: `< svg viewBox = "0 0 24 24" fill = "none" stroke = "currentColor" stroke - width="2.5" stroke - linecap="round" stroke - linejoin="round" style = "width: 16px; height: 16px;" ><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg >`
                            };
                        }
                    }
    </script>
</body>

</html>